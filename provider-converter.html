<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Provider Data Converter</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide icons as inline SVG components
    const Upload = ({ size = 24, ...props }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="17 8 12 3 7 8"/>
        <line x1="12" y1="3" x2="12" y2="15"/>
      </svg>
    );

    const Download = ({ size = 24, ...props }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
        <polyline points="7 10 12 15 17 10"/>
        <line x1="12" y1="15" x2="12" y2="3"/>
      </svg>
    );

    const Copy = ({ size = 24, ...props }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
    );

    const Check = ({ size = 24, ...props }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    );

    const Search = ({ size = 24, ...props }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.35-4.35"/>
      </svg>
    );

    function ProviderConverter() {
      const [providers, setProviders] = useState([]);
      const [jsCode, setJsCode] = useState('');
      const [copied, setCopied] = useState(false);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterSpecialty, setFilterSpecialty] = useState('All');
      const [fileName, setFileName] = useState('No file loaded');
      const fileInputRef = useRef(null);

      const handleFileUpload = (event) => {
        const file = event.target.files[0];
        if (file) {
          setFileName(file.name);
          const reader = new FileReader();
          reader.onload = (e) => {
            const csvText = e.target.result;
            parseCSVData(csvText);
          };
          reader.readAsText(file);
        }
      };

      const parseCSVData = (csvText) => {
        const lines = csvText.split('\n').filter(line => line.trim());
        const headers = parseCSVLine(lines[0]);
        
        const parsedProviders = lines.slice(1).map(line => {
          const values = parseCSVLine(line);
          const provider = {};
          headers.forEach((header, index) => {
            provider[header] = values[index] || '';
          });
          return provider;
        });
        
        setProviders(parsedProviders);
        generateJavaScriptCode(parsedProviders);
      };

      const parseCSVLine = (line) => {
        const result = [];
        let current = '';
        let inQuotes = false;
        
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            result.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        result.push(current.trim());
        return result;
      };

      const generateJavaScriptCode = (data) => {
        // Helper function to format field - only add quotes if value exists
        const formatField = (value) => {
          if (!value || value.trim() === '') {
            return '';
          }
          return `"${value}"`;
        };

        const code = `const csvData = \`"ID","Last Name","First Name","Degree","Gender","Specialty","Practice","Practice:Main Line","Practice:Fax","Accepting New Patients","Practice:Address","Practice:Address 2","Practice:City","Practice:Zip","Website Photo Path","Practice:Latitude","Practice:Longitude","Member Status"
${data.map(p => 
  `${formatField(p.ID)},${formatField(p['Last Name'])},${formatField(p['First Name'])},${formatField(p.Degree)},${formatField(p.Gender)},${formatField(p.Specialty)},${formatField(p.Practice)},${formatField(p['Practice:Main Line'])},${formatField(p['Practice:Fax'])},${formatField(p['Accepting New Patients'])},${formatField(p['Practice:Address'])},${formatField(p['Practice:Address 2'])},${formatField(p['Practice:City'])},${formatField(p['Practice:Zip'])},${formatField(p['Website Photo Path'])},${formatField(p['Practice:Latitude'])},${formatField(p['Practice:Longitude'])},${formatField(p['Member Status'])}`
).join('\n')}\`;`;
        
        setJsCode(code);
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(jsCode);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      const downloadFile = () => {
        const blob = new Blob([jsCode], { type: 'text/javascript' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'provider-data.js';
        a.click();
        URL.revokeObjectURL(url);
      };

      const specialties = ['All', ...new Set(providers.map(p => p.Specialty))].sort();

      const filteredProviders = providers.filter(p => {
        const matchesSearch = !searchTerm || 
          (p['Last Name'] && p['Last Name'].toLowerCase().includes(searchTerm.toLowerCase())) ||
          (p['First Name'] && p['First Name'].toLowerCase().includes(searchTerm.toLowerCase())) ||
          (p.Practice && p.Practice.toLowerCase().includes(searchTerm.toLowerCase()));
        const matchesSpecialty = filterSpecialty === 'All' || p.Specialty === filterSpecialty;
        return matchesSearch && matchesSpecialty;
      });

      return (
        <div className="min-h-screen" style={{
          background: 'linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%)',
          fontFamily: "'Inter', -apple-system, system-ui, sans-serif"
        }}>
          {/* Header */}
          <div className="border-b" style={{
            background: 'rgba(15, 23, 42, 0.8)',
            backdropFilter: 'blur(12px)',
            borderColor: 'rgba(148, 163, 184, 0.1)'
          }}>
            <div className="max-w-7xl mx-auto px-6 py-8">
              <div className="flex items-center justify-between">
                <div>
                  <h1 className="text-4xl font-bold mb-2" style={{
                    background: 'linear-gradient(135deg, #60a5fa 0%, #818cf8 100%)',
                    WebkitBackgroundClip: 'text',
                    WebkitTextFillColor: 'transparent',
                    letterSpacing: '-0.02em'
                  }}>
                    Provider Data Converter
                  </h1>
                  <p className="text-slate-400 text-lg">
                    Convert CSV to JavaScript format for interactive maps
                  </p>
                  <div className="mt-2 text-slate-500 text-sm">
                    Current file: <span className="text-slate-400 font-medium">{fileName}</span>
                  </div>
                </div>
                <div className="flex items-center gap-4">
                  <button
                    onClick={() => fileInputRef.current?.click()}
                    className="px-5 py-3 rounded-xl font-medium transition-all duration-200 flex items-center gap-2 hover:scale-105"
                    style={{
                      background: 'linear-gradient(135deg, #60a5fa 0%, #818cf8 100%)',
                      color: 'white',
                      boxShadow: '0 4px 20px rgba(96, 165, 250, 0.3)'
                    }}
                  >
                    <Upload size={20} />
                    Upload Sheet
                  </button>
                  <input
                    ref={fileInputRef}
                    type="file"
                    accept=".csv"
                    onChange={handleFileUpload}
                    className="hidden"
                  />
                  <div className="text-right">
                    <div className="text-3xl font-bold text-white">{providers.length}</div>
                    <div className="text-slate-400 text-sm">Total Providers</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-7xl mx-auto px-6 py-8">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              
              {/* Left Column - Provider List */}
              <div>
                <div className="rounded-2xl overflow-hidden" style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  backdropFilter: 'blur(20px)',
                  border: '1px solid rgba(148, 163, 184, 0.1)',
                  boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
                }}>
                  <div className="p-6 border-b" style={{
                    borderColor: 'rgba(148, 163, 184, 0.1)'
                  }}>
                    <h2 className="text-2xl font-bold text-white mb-4">Provider Preview</h2>
                    
                    {providers.length > 0 && (
                      <div className="space-y-3">
                        <div className="relative">
                          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400" size={20} />
                          <input
                            type="text"
                            placeholder="Search by name or practice..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full pl-11 pr-4 py-3 rounded-xl text-white placeholder-slate-500"
                            style={{
                              background: 'rgba(30, 41, 59, 0.5)',
                              border: '1px solid rgba(148, 163, 184, 0.2)',
                              outline: 'none'
                            }}
                          />
                        </div>
                        
                        <select
                          value={filterSpecialty}
                          onChange={(e) => setFilterSpecialty(e.target.value)}
                          className="w-full px-4 py-3 rounded-xl text-white"
                          style={{
                            background: 'rgba(30, 41, 59, 0.5)',
                            border: '1px solid rgba(148, 163, 184, 0.2)',
                            outline: 'none'
                          }}
                        >
                          {specialties.map(s => (
                            <option key={s} value={s}>{s}</option>
                          ))}
                        </select>

                        <div className="mt-3 text-slate-400 text-sm">
                          Showing {filteredProviders.length} of {providers.length} providers
                        </div>
                      </div>
                    )}

                    {providers.length === 0 && (
                      <div className="text-center py-8">
                        <Upload size={48} className="mx-auto text-slate-600 mb-3" />
                        <p className="text-slate-400">Click "Upload Sheet" to get started</p>
                      </div>
                    )}
                  </div>
                  
                  <div className="overflow-y-auto" style={{ maxHeight: '600px' }}>
                    {filteredProviders.map((provider, index) => (
                      <div
                        key={index}
                        className="p-5 border-b transition-all duration-200"
                        style={{
                          borderColor: 'rgba(148, 163, 184, 0.05)',
                          background: index % 2 === 0 ? 'rgba(15, 23, 42, 0.3)' : 'transparent'
                        }}
                      >
                        <div className="flex items-start justify-between mb-2">
                          <div>
                            <h3 className="text-white font-semibold text-lg">
                              {provider['First Name']} {provider['Last Name']}, {provider.Degree}
                            </h3>
                            <div className="flex items-center gap-2 mt-1">
                              <span className="px-2.5 py-0.5 rounded-full text-xs font-medium" style={{
                                background: 'rgba(96, 165, 250, 0.15)',
                                color: '#60a5fa'
                              }}>
                                {provider.Specialty}
                              </span>
                              <span className="px-2.5 py-0.5 rounded-full text-xs font-medium" style={{
                                background: provider['Accepting New Patients'] === 'True' 
                                  ? 'rgba(34, 197, 94, 0.15)' 
                                  : 'rgba(239, 68, 68, 0.15)',
                                color: provider['Accepting New Patients'] === 'True' 
                                  ? '#22c55e' 
                                  : '#ef4444'
                              }}>
                                {provider['Accepting New Patients'] === 'True' ? 'âœ“ Accepting' : 'Not Accepting'}
                              </span>
                            </div>
                          </div>
                        </div>
                        
                        <div className="mt-3 space-y-1 text-sm text-slate-300">
                          <div className="font-medium">{provider.Practice}</div>
                          <div className="text-slate-400">
                            {provider['Practice:Address']}
                            {provider['Practice:Address 2'] && `, ${provider['Practice:Address 2']}`}
                          </div>
                          <div className="text-slate-400">
                            {provider['Practice:City']}, RI {provider['Practice:Zip']}
                          </div>
                          <div className="text-slate-500 text-xs mt-2">
                            ðŸ“ž {provider['Practice:Main Line']}
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
              
              {/* Right Column - Code Output */}
              <div>
                <div className="rounded-2xl overflow-hidden h-full" style={{
                  background: 'rgba(15, 23, 42, 0.6)',
                  backdropFilter: 'blur(20px)',
                  border: '1px solid rgba(148, 163, 184, 0.1)',
                  boxShadow: '0 20px 60px rgba(0, 0, 0, 0.3)'
                }}>
                  <div className="p-6 border-b" style={{
                    borderColor: 'rgba(148, 163, 184, 0.1)'
                  }}>
                    <div className="flex items-center justify-between mb-4">
                      <h2 className="text-2xl font-bold text-white">Generated Code</h2>
                      {jsCode && (
                        <div className="flex gap-2">
                          <button
                            onClick={copyToClipboard}
                            className="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2"
                            style={{
                              background: copied ? 'rgba(34, 197, 94, 0.2)' : 'rgba(96, 165, 250, 0.2)',
                              color: copied ? '#22c55e' : '#60a5fa',
                              border: '1px solid',
                              borderColor: copied ? 'rgba(34, 197, 94, 0.3)' : 'rgba(96, 165, 250, 0.3)'
                            }}
                          >
                            {copied ? <Check size={18} /> : <Copy size={18} />}
                            {copied ? 'Copied!' : 'Copy'}
                          </button>
                          <button
                            onClick={downloadFile}
                            className="px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2"
                            style={{
                              background: 'rgba(129, 140, 248, 0.2)',
                              color: '#818cf8',
                              border: '1px solid rgba(129, 140, 248, 0.3)'
                            }}
                          >
                            <Download size={18} />
                            Download
                          </button>
                        </div>
                      )}
                    </div>
                    
                    <p className="text-slate-400 text-sm">
                      {jsCode ? 'Copy this code and paste it into your HTML file, or download as a .js file' : 'Upload a CSV file to generate the code'}
                    </p>
                  </div>
                  
                  <div className="p-6">
                    {jsCode ? (
                      <>
                        <div className="rounded-xl overflow-hidden" style={{
                          background: 'rgba(0, 0, 0, 0.3)',
                          border: '1px solid rgba(148, 163, 184, 0.1)'
                        }}>
                          <pre className="p-4 overflow-x-auto text-sm" style={{
                            maxHeight: '650px',
                            color: '#94a3b8',
                            fontFamily: "'Fira Code', 'Monaco', monospace"
                          }}>
                            <code>{jsCode}</code>
                          </pre>
                        </div>
                        
                        <div className="mt-4 p-4 rounded-xl" style={{
                          background: 'rgba(59, 130, 246, 0.1)',
                          border: '1px solid rgba(59, 130, 246, 0.2)'
                        }}>
                          <div className="text-blue-400 font-medium mb-2 text-sm">ðŸ’¡ Usage Instructions:</div>
                          <ol className="text-slate-300 text-sm space-y-1 list-decimal list-inside">
                            <li>Copy the generated code above</li>
                            <li>Paste it into your HTML file inside a &lt;script&gt; tag</li>
                            <li>The data will be available as <code className="px-1.5 py-0.5 rounded" style={{ background: 'rgba(0,0,0,0.3)' }}>csvData</code></li>
                            <li>Parse it using your existing CSV parser function</li>
                          </ol>
                        </div>
                      </>
                    ) : (
                      <div className="text-center py-20">
                        <div className="text-slate-600 mb-4 text-6xl">ðŸ“„</div>
                        <p className="text-slate-400 text-lg">No code generated yet</p>
                        <p className="text-slate-500 text-sm mt-2">Upload a CSV file to begin</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
              
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<ProviderConverter />, document.getElementById('root'));
  </script>
</body>
</html>